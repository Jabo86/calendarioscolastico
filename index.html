<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario Scolastico</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Roboto Mono', monospace;
            background: linear-gradient(135deg, #1E3A8A, #3B82F6);
            color: #000000; /* Tutte le scritte nere */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 15px;
        }
        .container {
            width: 100%;
            max-width: 420px;
            background: rgba(30, 58, 138, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: fadeIn 0.7s ease-in;
            position: relative;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 {
            font-size: 1.5em;
            color: #000000; /* Nero */
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.8);
            text-align: center;
            margin-bottom: 15px;
        }
        .month-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        h2.month-display {
            font-size: 1.2em;
            color: #000000; /* Nero */
            text-align: center;
            flex: 1;
        }
        .nav-buttons button {
            background: none;
            border: none;
            font-size: 1em;
            color: #000000; /* Nero */
            cursor: pointer;
            padding: 5px 10px;
            transition: color 0.3s, text-shadow 0.3s;
        }
        .nav-buttons button:hover {
            color: #333333; /* Grigio scuro per hover */
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.8);
        }
        table {
            width: 100%;
            max-width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
            background: rgba(59, 130, 246, 0.8);
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        th, td {
            border: 1px solid rgba(255, 215, 0, 0.4);
            padding: 6px;
            text-align: center;
        }
        th {
            background: linear-gradient(45deg, #FFD700, #FFFF33);
            color: #000000; /* Nero */
            font-weight: 700;
            position: sticky;
            top: 0;
        }
        th.current-day, td.current-day {
            background: rgba(255, 215, 0, 0.4);
            border: 2px solid #FFFF33;
            box-shadow: 0 0 12px rgba(255, 215, 0, 0.8);
        }
        th.has-notes {
            background: linear-gradient(45deg, #FF3333, #FF6666); /* Rosso per note */
            color: #000000; /* Nero */
        }
        th .note-icon {
            cursor: pointer;
            margin-left: 3px;
            font-size: 0.8em;
            background: #1E3A8A;
            color: #000000; /* Nero */
            border-radius: 50%;
            padding: 3px 7px;
            transition: transform 0.3s, box-shadow 0.3s;
            vertical-align: middle;
        }
        th .note-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        th .day-number {
            display: block;
            font-size: 0.85em;
            margin-bottom: 4px;
            color: #000000; /* Nero */
        }
        th.has-notes .day-number {
            color: #000000; /* Nero */
        }
        td {
            background: rgba(59, 130, 246, 0.9);
            cursor: pointer;
            color: #000000; /* Nero */
        }
        .time-column {
            background: linear-gradient(45deg, #FFD700, #FFFF33); /* Giallo */
            color: #000000; /* Nero */
            font-weight: 500;
            width: 80px;
        }
        input[type="text"] {
            width: 100%;
            border: none;
            background: transparent;
            color: #000000; /* Nero */
            text-align: center;
            font-size: 0.9em;
            padding: 4px;
            transition: background 0.3s, box-shadow 0.3s;
        }
        input[type="text"]:focus {
            background: rgba(255, 215, 0, 0.5);
            outline: none;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        .action-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #FFD700, #FFFF33);
            color: #000000; /* Nero */
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.9);
        }
        .action-button.grades {
            background: linear-gradient(45deg, #FFFF33, #FFD700);
        }
        .stats-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .stats-buttons button {
            flex: 1;
            padding: 10px;
            background: linear-gradient(45deg, #FFD700, #FFFF33);
            color: #000000; /* Nero */
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .stats-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.9);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: modalFade 0.7s ease-in;
        }
        @keyframes modalFade {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background: rgba(30, 58, 138, 0.95);
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 360px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.9);
        }
        .modal-content h2 {
            font-size: 1.5em;
            color: #000000; /* Nero */
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.8);
            margin: 0 0 10px;
        }
        .modal-content h3 {
            font-size: 1.1em;
            color: #000000; /* Nero */
            margin: 10px 0 5px;
            text-align: center;
        }
        .note-input, .grade-input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid rgba(255, 215, 0, 0.5);
            border-radius: 5px;
            background: rgba(59, 130, 246, 0.9);
            color: #000000; /* Nero */
            font-size: 0.95em;
            transition: box-shadow 0.3s;
        }
        .note-input:focus, .grade-input:focus {
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        .grade-input {
            width: 40px;
            padding: 6px;
            margin: 3px;
            text-align: center;
            font-size: 0.85em;
        }
        .grade-input:focus {
            border-color: #FFFF33;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
        .grade-container {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            margin: 5px 0;
        }
        .note-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .note-container input[type="checkbox"] {
            margin-right: 10px;
            accent-color: #FFD700;
        }
        .note-container.completed input.note-input {
            text-decoration: line-through;
            opacity: 0.7;
        }
        .stats-content {
            font-size: 0.95em;
            color: #000000; /* Nero */
            line-height: 1.5;
        }
        .stats-content p {
            margin: 5px 0;
            color: #000000; /* Nero */
        }
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        .modal-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .modal-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.9);
        }
        .save-note, .save-grades {
            background: linear-gradient(45deg, #FFD700, #FFFF33);
            color: #000000; /* Nero */
        }
        .close-modal {
            background: linear-gradient(45deg, #FFFF33, #FFD700);
            color: #000000; /* Nero */
        }
        .afternoon-section {
            margin-top: 15px;
        }
        .language-selector {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
        }
        .language-flag {
            width: 24px;
            height: 24px;
            cursor: pointer;
            border-radius: 50%;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid #FFFF33;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.9);
        }
        .language-flag:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255, 215, 0, 1);
        }
        .language-dropdown {
            display: none;
            position: absolute;
            top: 30px;
            left: 0;
            background: rgba(30, 58, 138, 0.95);
            border: 1px solid #FFFF33;
            border-radius: 5px;
            padding: 5px;
            flex-direction: column;
            gap: 5px;
            z-index: 11;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.9);
        }
        .language-dropdown.show {
            display: flex;
        }
        .language-dropdown img {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(255, 215, 0, 0.5);
        }
        .language-dropdown img:hover {
            transform: scale(1.1);
            border: 1px solid #FFFF33;
            box-shadow: 0 0 12px rgba(255, 215, 0, 0.9);
        }
        .day-name {
            display: inline-block;
            min-width: 30px;
            text-align: center;
        }
        .notification-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }
        .notification-content {
            background: #FF3333;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 360px;
            text-align: center;
            color: #000000; /* Nero */
            box-shadow: 0 0 20px rgba(255, 51, 51, 0.9);
        }
        .notification-content p {
            font-size: 1em;
            margin-bottom: 15px;
            color: #000000; /* Nero */
        }
        .notification-buttons {
            display: flex;
            justify-content: space-around;
        }
        .notification-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            background: linear-gradient(45deg, #FFD700, #FFFF33);
            color: #000000; /* Nero */
        }
        .notification-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.9);
        }
        @media (max-width: 400px) {
            .container {
                padding: 12px;
            }
            h1 {
                font-size: 1.3em;
            }
            h2.month-display {
                font-size: 1em;
            }
            h3 {
                font-size: 1em;
            }
            table {
                font-size: 0.85em;
            }
            th, td {
                padding: 5px;
            }
            .time-column {
                width: 70px;
            }
            .grade-input {
                width: 36px;
                font-size: 0.8em;
            }
            .stats-buttons {
                flex-direction: column;
                gap: 5px;
            }
            .nav-buttons button {
                font-size: 0.9em;
                padding: 5px;
            }
            .language-selector {
                top: 5px;
                left: 5px;
            }
            .language-flag {
                width: 20px;
                height: 20px;
                border: 2px solid #FFFF33;
                box-shadow: 0 0 12px rgba(255, 215, 0, 0.9);
            }
            .language-flag:hover {
                box-shadow: 0 0 15px rgba(255, 215, 0, 1);
            }
            .language-dropdown {
                top: 25px;
                border: 1px solid #FFFF33;
                box-shadow: 0 0 12px rgba(255, 215, 0, 0.9);
            }
            .language-dropdown img {
                width: 18px;
                height: 18px;
            }
            .language-dropdown img:hover {
                border: 1px solid #FFFF33;
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.9);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="language-selector">
            <img src="https://flagcdn.com/w20/it.png" alt="Italiano" class="language-flag" id="current-flag" data-lang="it" title="Italiano">
            <div class="language-dropdown" id="language-dropdown">
                <img src="https://flagcdn.com/w20/it.png" alt="Italiano" data-lang="it" title="Italiano">
                <img src="https://flagcdn.com/w20/gb.png" alt="English" data-lang="en" title="English">
                <img src="https://flagcdn.com/w20/fr.png" alt="Français" data-lang="fr" title="Français">
                <img src="https://flagcdn.com/w20/de.png" alt="Deutsch" data-lang="de" title="Deutsch">
                <img src="https://flagcdn.com/w20/es.png" alt="Español" data-lang="es" title="Español">
            </div>
        </div>
        <h1 id="calendar-title">Calendario Scolastico</h1>
        <div class="month-nav">
            <div class="nav-buttons">
                <button onclick="prevWeek()">Precedente</button>
            </div>
            <h2 class="month-display" id="month-display"></h2>
            <div class="nav-buttons">
                <button onclick="nextWeek()">Successivo</button>
            </div>
        </div>
        <table id="calendar-morning">
            <thead>
                <tr>
                    <th>Orario</th>
                    <th><span class="day-number" id="day-lun"></span><span class="day-name" id="day-lun-short">Lun</span><span class="note-icon" onclick="openNotes(0)">✍️</span></th>
                    <th><span class="day-number" id="day-mar"></span><span class="day-name" id="day-mar-short">Mar</span><span class="note-icon" onclick="openNotes(1)">✍️</span></th>
                    <th><span class="day-number" id="day-mer"></span><span class="day-name" id="day-mer-short">Mer</span><span class="note-icon" onclick="openNotes(2)">✍️</span></th>
                    <th><span class="day-number" id="day-gio"></span><span class="day-name" id="day-gio-short">Gio</span><span class="note-icon" onclick="openNotes(3)">✍️</span></th>
                    <th><span class="day-number" id="day-ven"></span><span class="day-name" id="day-ven-short">Ven</span><span class="note-icon" onclick="openNotes(4)">✍️</span></th>
                    <th><span class="day-number" id="day-sab"></span><span class="day-name" id="day-sab-short">Sab</span><span class="note-icon" onclick="openNotes(5)">✍️</span></th>
                </tr>
            </thead>
            <tbody id="calendar-morning-body"></tbody>
        </table>
        <div class="afternoon-section">
            <h3 id="afternoon-title">Rientro</h3>
            <table id="calendar-afternoon">
                <thead>
                    <tr>
                        <th>Orario</th>
                        <th><span class="day-number" id="day-lun-afternoon"></span><span class="day-name" id="day-lun-afternoon-short">Lun</span></th>
                        <th><span class="day-number" id="day-mar-afternoon"></span><span class="day-name" id="day-mar-afternoon-short">Mar</span></th>
                        <th><span class="day-number" id="day-mer-afternoon"></span><span class="day-name" id="day-mer-afternoon-short">Mer</span></th>
                        <th><span class="day-number" id="day-gio-afternoon"></span><span class="day-name" id="day-gio-afternoon-short">Gio</span></th>
                        <th><span class="day-number" id="day-ven-afternoon"></span><span class="day-name" id="day-ven-afternoon-short">Ven</span></th>
                        <th><span class="day-number" id="day-sab-afternoon"></span><span class="day-name" id="day-sab-afternoon-short">Sab</span></th>
                    </tr>
                </thead>
                <tbody id="calendar-afternoon-body"></tbody>
            </table>
        </div>
        <button class="action-button grades" onclick="openGrades()">Gestisci Voti</button>
        <button class="action-button" onclick="showStats()">Statistiche</button>
        <button class="action-button" onclick="showResetNotification()">Reset Dati</button>
    </div>

    <div class="modal" id="notes-modal">
        <div class="modal-content">
            <h2 id="notes-modal-title">Note per <span id="notes-day"></span></h2>
            <div id="notes-list"></div>
            <div class="modal-buttons">
                <button class="save-note" onclick="saveNotes()">Salva</button>
                <button class="close-modal" onclick="closeNotes()">Chiudi</button>
            </div>
        </div>
    </div>

    <div class="modal" id="stats-modal">
        <div class="modal-content">
            <h2 id="stats-modal-title">Statistiche</h2>
            <div class="stats-buttons">
                <button onclick="showFirstTerm()">Primo Quadrimestre</button>
                <button onclick="showSecondTerm()">Secondo Quadrimestre</button>
                <button onclick="showFinalGrades()">Voti Finali</button>
            </div>
            <div class="stats-content" id="stats-content"></div>
            <div class="modal-buttons">
                <button class="close-modal" onclick="closeStats()">Chiudi</button>
            </div>
        </div>
    </div>

    <div class="modal" id="grades-modal">
        <div class="modal-content">
            <h2 id="grades-modal-title">Gestisci Voti</h2>
            <div id="grades-list"></div>
            <div class="modal-buttons">
                <button class="save-grades" onclick="saveGrades()">Salva</button>
                <button class="close-modal" onclick="closeGrades()">Chiudi</button>
            </div>
        </div>
    </div>

    <div class="modal" id="final-grades-modal">
        <div class="modal-content">
            <h2 id="final-grades-modal-title">Voti Finali</h2>
            <div class="stats-content" id="final-grades-content"></div>
            <div class="modal-buttons">
                <button class="close-modal" onclick="closeFinalGrades()">Chiudi</button>
            </div>
        </div>
    </div>

    <div class="modal" id="notification-modal">
        <div class="notification-content">
            <p id="notification-message"></p>
            <div class="notification-buttons" id="notification-buttons">
                <!-- Bottoni aggiunti dinamicamente -->
            </div>
        </div>
    </div>

    <script>
        // Oggetto delle traduzioni
        const translations = {
            it: {
                calendarTitle: "Calendario Scolastico",
                prev: "Precedente",
                next: "Successivo",
                afternoon: "Rientro",
                manageGrades: "Gestisci Voti",
                stats: "Statistiche",
                resetData: "Reset Dati",
                notesFor: "Note per",
                save: "Salva",
                close: "Chiudi",
                firstTerm: "Primo Quadrimestre",
                secondTerm: "Secondo Quadrimestre",
                finalGrades: "Voti Finali",
                oralGrades: "Voti Orali",
                writtenGrades: "Voti Scritti",
                noSubjects: "Nessuna materia inserita.",
                firstTermPeriod: "Primo Quadrimestre (Settembre-Dicembre 2024)",
                secondTermPeriod: "Secondo Quadrimestre (Gennaio-Maggio 2025)",
                finalGradesTitle: "Voti Finali",
                note: "Nota",
                subject: "Materia",
                resetConfirm: "Vuoi resettare tutti i dati? Questa azione non può essere annullata.",
                resetSuccess: "Dati resettati con successo!",
                maxNotes: "Massimo 10 note per giorno!",
                error: "Si è verificato un errore.",
                days: {
                    full: ["Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato"],
                    short: ["Lun", "Mar", "Mer", "Gio", "Ven", "Sab"]
                }
            },
            en: {
                calendarTitle: "School Calendar",
                prev: "Previous",
                next: "Next",
                afternoon: "Afternoon",
                manageGrades: "Manage Grades",
                stats: "Statistics",
                resetData: "Reset Data",
                notesFor: "Notes for",
                save: "Save",
                close: "Close",
                firstTerm: "First Term",
                secondTerm: "Second Term",
                finalGrades: "Final Grades",
                oralGrades: "Oral Grades",
                writtenGrades: "Written Grades",
                noSubjects: "No subjects added.",
                firstTermPeriod: "First Term (September-December 2024)",
                secondTermPeriod: "Second Term (January-May 2025)",
                finalGradesTitle: "Final Grades",
                note: "Note",
                subject: "Subject",
                resetConfirm: "Do you want to reset all data? This action cannot be undone.",
                resetSuccess: "Data reset successfully!",
                maxNotes: "Maximum 10 notes per day!",
                error: "An error occurred.",
                days: {
                    full: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
                    short: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]
                }
            },
            fr: {
                calendarTitle: "Calendrier Scolaire",
                prev: "Précédent",
                next: "Suivant",
                afternoon: "Après-midi",
                manageGrades: "Gérer les Notes",
                stats: "Statistiques",
                resetData: "Réinitialiser les Données",
                notesFor: "Notes pour",
                save: "Enregistrer",
                close: "Fermer",
                firstTerm: "Premier Trimestre",
                secondTerm: "Deuxième Trimestre",
                finalGrades: "Notes Finales",
                oralGrades: "Notes Orales",
                writtenGrades: "Notes Écrites",
                noSubjects: "Aucune matière ajoutée.",
                firstTermPeriod: "Premier Trimestre (Septembre-Décembre 2024)",
                secondTermPeriod: "Deuxième Trimestre (Janvier-Mai 2025)",
                finalGradesTitle: "Notes Finales",
                note: "Note",
                subject: "Matière",
                resetConfirm: "Voulez-vous réinitialiser toutes les données ? Cette action est irréversible.",
                resetSuccess: "Données réinitialisées avec succès !",
                maxNotes: "Maximum 10 notes par jour !",
                error: "Une erreur s'est produite.",
                days: {
                    full: ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"],
                    short: ["Lun", "Mar", "Mer", "Jeu", "Ven", "Sam"]
                }
            },
            de: {
                calendarTitle: "Schulkalender",
                prev: "Vorherige",
                next: "Nächste",
                afternoon: "Nachmittag",
                manageGrades: "Noten Verwalten",
                stats: "Statistiken",
                resetData: "Daten Zurücksetzen",
                notesFor: "Notizen für",
                save: "Speichern",
                close: "Schließen",
                firstTerm: "Erstes Trimester",
                secondTerm: "Zweites Trimester",
                finalGrades: "Endnoten",
                oralGrades: "Mündliche Noten",
                writtenGrades: "Schriftliche Noten",
                noSubjects: "Keine Fächer hinzugefügt.",
                firstTermPeriod: "Erstes Trimester (September-Dezember 2024)",
                secondTermPeriod: "Zweites Trimester (Januar-Mai 2025)",
                finalGradesTitle: "Endnoten",
                note: "Notiz",
                subject: "Fach",
                resetConfirm: "Möchten Sie alle Daten zurücksetzen? Diese Aktion kann nicht rückgängig gemacht werden.",
                resetSuccess: "Daten erfolgreich zurückgesetzt!",
                maxNotes: "Maximal 10 Notizen pro Tag!",
                error: "Ein Fehler ist aufgetreten.",
                days: {
                    full: ["Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag"],
                    short: ["Mo", "Di", "Mi", "Do", "Fr", "Sa"]
                }
            },
            es: {
                calendarTitle: "Calendario Escolar",
                prev: "Anterior",
                next: "Siguiente",
                afternoon: "Tarde",
                manageGrades: "Gestionar Notas",
                stats: "Estadísticas",
                resetData: "Restablecer Datos",
                notesFor: "Notas para",
                save: "Guardar",
                close: "Cerrar",
                firstTerm: "Primer Trimestre",
                secondTerm: "Segundo Trimestre",
                finalGrades: "Notas Finales",
                oralGrades: "Notas Orales",
                writtenGrades: "Notas Escritas",
                noSubjects: "No hay asignaturas añadidas.",
                firstTermPeriod: "Primer Trimestre (Septiembre-Diciembre 2024)",
                secondTermPeriod: "Segundo Trimestre (Enero-Mayo 2025)",
                finalGradesTitle: "Notas Finales",
                note: "Nota",
                subject: "Asignatura",
                resetConfirm: "¿Quieres restablecer todos los datos? Esta acción no se puede deshacer.",
                resetSuccess: "¡Datos restablecidos con éxito!",
                maxNotes: "¡Máximo 10 notas por día!",
                error: "Ha ocurrido un error.",
                days: {
                    full: ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"],
                    short: ["Lun", "Mar", "Mié", "Jue", "Vie", "Sáb"]
                }
            }
        };

        // Mappa per i codici locali di toLocaleString
        const localeMap = {
            it: 'it-IT',
            en: 'en-US',
            fr: 'fr-FR',
            de: 'de-DE',
            es: 'es-ES'
        };

        // Lingua predefinita
        let currentLang = localStorage.getItem("language") || "it";

        // Funzione per mostrare una notifica personalizzata
        function showNotification(message, isConfirm = false, onConfirm = null) {
            try {
                const modal = document.getElementById("notification-modal");
                const messageElement = document.getElementById("notification-message");
                const buttonsElement = document.getElementById("notification-buttons");

                messageElement.textContent = message;
                buttonsElement.innerHTML = "";

                if (isConfirm) {
                    const confirmButton = document.createElement("button");
                    confirmButton.textContent = translations[currentLang].save;
                    confirmButton.onclick = () => {
                        if (onConfirm) onConfirm();
                        modal.style.display = "none";
                    };
                    buttonsElement.appendChild(confirmButton);

                    const cancelButton = document.createElement("button");
                    cancelButton.textContent = translations[currentLang].close;
                    cancelButton.onclick = () => modal.style.display = "none";
                    buttonsElement.appendChild(cancelButton);
                } else {
                    const closeButton = document.createElement("button");
                    closeButton.textContent = translations[currentLang].close;
                    closeButton.onclick = () => modal.style.display = "none";
                    buttonsElement.appendChild(closeButton);
                }

                modal.style.display = "flex";
            } catch (error) {
                console.error("Errore in showNotification:", error);
            }
        }

        // Funzione per aggiornare l'interfaccia con la lingua selezionata
        function updateLanguage(lang) {
            try {
                currentLang = lang;
                localStorage.setItem("language", lang);

                // Aggiorna la bandiera corrente
                const currentFlag = document.getElementById("current-flag");
                currentFlag.src = `https://flagcdn.com/w20/${lang === "en" ? "gb" : lang}.png`;
                currentFlag.dataset.lang = lang;
                currentFlag.alt = translations[lang].calendarTitle;
                currentFlag.title = translations[lang].calendarTitle;

                // Chiudi il dropdown
                document.getElementById("language-dropdown").classList.remove("show");

                // Aggiorna i testi dell'interfaccia
                document.getElementById("calendar-title").textContent = translations[lang].calendarTitle;
                document.querySelector(".nav-buttons button[onclick='prevWeek()']").textContent = translations[lang].prev;
                document.querySelector(".nav-buttons button[onclick='nextWeek()']").textContent = translations[lang].next;
                document.getElementById("afternoon-title").textContent = translations[lang].afternoon;
                document.querySelector(".action-button.grades").textContent = translations[lang].manageGrades;
                document.querySelector(".action-button[onclick='showStats()']").textContent = translations[lang].stats;
                document.querySelector(".action-button[onclick='showResetNotification()']").textContent = translations[lang].resetData;

                document.getElementById("notes-modal-title").innerHTML = `${translations[lang].notesFor} <span id="notes-day"></span>`;
                document.querySelector("#notes-modal .save-note").textContent = translations[lang].save;
                document.querySelector("#notes-modal .close-modal").textContent = translations[lang].close;

                document.getElementById("stats-modal-title").textContent = translations[lang].stats;
                document.querySelector("#stats-modal button[onclick='showFirstTerm()']").textContent = translations[lang].firstTerm;
                document.querySelector("#stats-modal button[onclick='showSecondTerm()']").textContent = translations[lang].secondTerm;
                document.querySelector("#stats-modal button[onclick='showFinalGrades()']").textContent = translations[lang].finalGrades;
                document.querySelector("#stats-modal .close-modal").textContent = translations[lang].close;

                document.getElementById("grades-modal-title").textContent = translations[lang].manageGrades;
                document.querySelector("#grades-modal .save-grades").textContent = translations[lang].save;
                document.querySelector("#grades-modal .close-modal").textContent = translations[lang].close;

                document.getElementById("final-grades-modal-title").textContent = translations[lang].finalGradesTitle;
                document.querySelector("#final-grades-modal .close-modal").textContent = translations[lang].close;

                // Aggiorna il calendario
                updateWeekDisplay();

                // Aggiorna contenuti dinamici se aperti
                if (document.getElementById("stats-modal").style.display === "flex") showStats();
                if (document.getElementById("grades-modal").style.display === "flex") openGrades();
                if (document.getElementById("final-grades-modal").style.display === "flex") showFinalGrades();
            } catch (error) {
                console.error("Errore in updateLanguage:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Gestione del dropdown
        function toggleDropdown() {
            document.getElementById("language-dropdown").classList.toggle("show");
        }

        // Chiudi il dropdown se si clicca fuori
        document.addEventListener("click", (event) => {
            const selector = document.querySelector(".language-selector");
            if (!selector.contains(event.target)) {
                document.getElementById("language-dropdown").classList.remove("show");
            }
        });

        // Event listener per il cambio lingua
        document.addEventListener("DOMContentLoaded", () => {
            const currentFlag = document.getElementById("current-flag");
            currentFlag.addEventListener("click", toggleDropdown);

            document.querySelectorAll(".language-dropdown img").forEach(flag => {
                flag.addEventListener("click", () => {
                    updateLanguage(flag.dataset.lang);
                });
            });

            updateLanguage(currentLang);
        });

        const defaultHours = [
            "1ª Ora", "2ª Ora", "3ª Ora", "4ª Ora", "5ª Ora", "6ª Ora", "7ª Ora",
            "8ª Ora", "9ª Ora"
        ];
        let hours = JSON.parse(localStorage.getItem("schoolHours")) || defaultHours;
        let currentDayNotes = null;
        let currentWeekStart = new Date(2025, 4, 12); // Inizio settimana: 12 Maggio 2025
        const referenceWeek = new Date(2024, 8, 1).toISOString(); // 1 settembre 2024
        const today = new Date();

        // Funzione per mostrare la notifica di reset
        function showResetNotification() {
            showNotification(translations[currentLang].resetConfirm, true, resetData);
        }

        // Funzione per resettare i dati
        function resetData() {
            try {
                localStorage.removeItem("schoolHours");
                localStorage.removeItem("schoolSchedule");
                localStorage.removeItem("schoolNotes");
                localStorage.removeItem("schoolGrades");
                hours = defaultHours;
                localStorage.setItem("schoolHours", JSON.stringify(hours));
                showNotification(translations[currentLang].resetSuccess);
                updateWeekDisplay();
            } catch (error) {
                console.error("Errore in resetData:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per ottenere i giorni della settimana corrente
        function getWeekDays(startDate) {
            try {
                if (!(startDate instanceof Date) || isNaN(startDate)) {
                    throw new Error("Data non valida");
                }
                const days = [];
                for (let i = 0; i < 6; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    days.push({
                        day: translations[currentLang].days.full[i],
                        date: date.getDate(),
                        fullDate: date
                    });
                }
                return days;
            } catch (error) {
                console.error("Errore in getWeekDays:", error);
                return [];
            }
        }

        // Funzione per aggiornare la visualizzazione dei giorni e del mese
        function updateWeekDisplay() {
            try {
                const weekDays = getWeekDays(currentWeekStart);
                if (!weekDays.length) {
                    console.error("Nessun giorno valido generato");
                    return;
                }

                // Aggiorna i numeri dei giorni
                const dayIds = ["lun", "mar", "mer", "gio", "ven", "sab"];
                dayIds.forEach((id, index) => {
                    document.getElementById(`day-${id}`).textContent = weekDays[index].date;
                    document.getElementById(`day-${id}-afternoon`).textContent = weekDays[index].date;
                    document.getElementById(`day-${id}-short`).textContent = translations[currentLang].days.short[index];
                    document.getElementById(`day-${id}-afternoon-short`).textContent = translations[currentLang].days.short[index];
                });

                // Aggiorna il mese
                document.getElementById("month-display").textContent = currentWeekStart.toLocaleString(localeMap[currentLang], { month: 'long', year: 'numeric' });

                // Evidenzia il giorno corrente
                const thElementsMorning = document.querySelectorAll("#calendar-morning th:not(:first-child)");
                const tdElementsMorning = document.querySelectorAll("#calendar-morning td");
                const thElementsAfternoon = document.querySelectorAll("#calendar-afternoon th:not(:first-child)");
                const tdElementsAfternoon = document.querySelectorAll("#calendar-afternoon td");

                thElementsMorning.forEach((th, index) => {
                    th.classList.remove("current-day");
                    if (weekDays[index]) {
                        const dayDate = weekDays[index].fullDate;
                        if (dayDate.toDateString() === today.toDateString()) {
                            th.classList.add("current-day");
                        }
                    }
                });

                tdElementsMorning.forEach(td => {
                    td.classList.remove("current-day");
                    const rowCells = td.parentElement.children;
                    for (let i = 1; i < rowCells.length; i++) {
                        if (rowCells[i] === td && weekDays[i - 1]) {
                            const dayDate = weekDays[i - 1].fullDate;
                            if (dayDate.toDateString() === today.toDateString()) {
                                td.classList.add("current-day");
                            }
                        }
                    }
                });

                thElementsAfternoon.forEach((th, index) => {
                    th.classList.remove("current-day");
                    if (weekDays[index]) {
                        const dayDate = weekDays[index].fullDate;
                        if (dayDate.toDateString() === today.toDateString()) {
                            th.classList.add("current-day");
                        }
                    }
                });

                tdElementsAfternoon.forEach(td => {
                    td.classList.remove("current-day");
                    const rowCells = td.parentElement.children;
                    for (let i = 1; i < rowCells.length; i++) {
                        if (rowCells[i] === td && weekDays[i - 1]) {
                            const dayDate = weekDays[i - 1].fullDate;
                            if (dayDate.toDateString() === today.toDateString()) {
                                td.classList.add("current-day");
                            }
                        }
                    }
                });

                generateCalendar();
                updateNotesHighlight();
            } catch (error) {
                console.error("Errore in updateWeekDisplay:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per navigare alla settimana precedente
        function prevWeek() {
            try {
                const newStart = new Date(currentWeekStart);
                newStart.setDate(currentWeekStart.getDate() - 7);
                if (isNaN(newStart)) throw new Error("Data non valida");
                currentWeekStart = newStart;
                updateWeekDisplay();
            } catch (error) {
                console.error("Errore in prevWeek:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per navigare alla settimana successiva
        function nextWeek() {
            try {
                const newStart = new Date(currentWeekStart);
                newStart.setDate(currentWeekStart.getDate() + 7);
                if (isNaN(newStart)) throw new Error("Data non valida");
                currentWeekStart = newStart;
                updateWeekDisplay();
            } catch (error) {
                console.error("Errore in nextWeek:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per sincronizzare l'orario in tutte le settimane
        function syncSchedule() {
            try {
                const schedule = JSON.parse(localStorage.getItem("schoolSchedule") || "{}");
                const refSchedule = schedule[referenceWeek] || {};

                Object.keys(schedule).forEach(week => {
                    if (week !== referenceWeek) {
                        schedule[week] = JSON.parse(JSON.stringify(refSchedule));
                    }
                });

                localStorage.setItem("schoolSchedule", JSON.stringify(schedule));
            } catch (error) {
                console.error("Errore in syncSchedule:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per generare il calendario
        function generateCalendar() {
            try {
                // Genera la tabella mattutina (1ª-7ª Ora)
                const morningTbody = document.getElementById("calendar-morning-body");
                morningTbody.innerHTML = "";
                const morningHours = hours.slice(0, 7);

                morningHours.forEach((hour, index) => {
                    const row = document.createElement("tr");
                    const timeCell = document.createElement("td");
                    timeCell.classList.add("time-column");
                    const timeInput = document.createElement("input");
                    timeInput.type = "text";
                    timeInput.value = hour;
                    timeInput.dataset.index = index;
                    timeInput.addEventListener("change", saveHours);
                    timeCell.appendChild(timeInput);
                    row.appendChild(timeCell);

                    translations[currentLang].days.full.forEach((day, dayIndex) => {
                        const cell = document.createElement("td");
                        const input = document.createElement("input");
                        input.type = "text";
                        input.placeholder = translations[currentLang].subject;
                        input.dataset.hour = hour;
                        input.dataset.day = day;
                        input.dataset.week = currentWeekStart.toISOString();
                        input.dataset.dayIndex = dayIndex;
                        input.addEventListener("change", saveSchedule);
                        cell.appendChild(input);
                        row.appendChild(cell);
                    });

                    morningTbody.appendChild(row);
                });

                // Genera la tabella pomeridiana (8ª-9ª Ora)
                const afternoonTbody = document.getElementById("calendar-afternoon-body");
                afternoonTbody.innerHTML = "";
                const afternoonHours = hours.slice(7, 9);

                afternoonHours.forEach((hour, index) => {
                    const row = document.createElement("tr");
                    const timeCell = document.createElement("td");
                    timeCell.classList.add("time-column");
                    const timeInput = document.createElement("input");
                    timeInput.type = "text";
                    timeInput.value = hour;
                    timeInput.dataset.index = parseInt(index) + 7;
                    timeInput.addEventListener("change", saveHours);
                    timeCell.appendChild(timeInput);
                    row.appendChild(timeCell);

                    translations[currentLang].days.full.forEach((day, dayIndex) => {
                        const cell = document.createElement("td");
                        const input = document.createElement("input");
                        input.type = "text";
                        input.placeholder = translations[currentLang].subject;
                        input.dataset.hour = hour;
                        input.dataset.day = day;
                        input.dataset.week = currentWeekStart.toISOString();
                        input.dataset.dayIndex = dayIndex;
                        input.addEventListener("change", saveSchedule);
                        cell.appendChild(input);
                        row.appendChild(cell);
                    });

                    afternoonTbody.appendChild(row);
                });

                loadSchedule();
            } catch (error) {
                console.error("Errore in generateCalendar:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per salvare gli orari
        function saveHours(event) {
            try {
                const input = event.target;
                const index = input.dataset.index;
                hours[index] = input.value.trim() || defaultHours[index];
                localStorage.setItem("schoolHours", JSON.stringify(hours));
                generateCalendar();
            } catch (error) {
                console.error("Errore in saveHours:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per salvare l'orario
        function saveSchedule(event) {
            try {
                const input = event.target;
                const hour = input.dataset.hour;
                const day = input.dataset.day;
                const week = input.dataset.week;
                const subject = input.value.trim();

                const schedule = JSON.parse(localStorage.getItem("schoolSchedule") || "{}");
                if (!schedule[week]) schedule[week] = {};
                if (!schedule[week][day]) schedule[week][day] = {};
                schedule[week][day][hour] = subject;

                if (!schedule[referenceWeek]) schedule[referenceWeek] = {};
                if (!schedule[referenceWeek][day]) schedule[referenceWeek][day] = {};
                schedule[referenceWeek][day][hour] = subject;

                localStorage.setItem("schoolSchedule", JSON.stringify(schedule));
                syncSchedule();
            } catch (error) {
                console.error("Errore in saveSchedule:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per caricare l'orario salvato
        function loadSchedule() {
            try {
                const schedule = JSON.parse(localStorage.getItem("schoolSchedule") || "{}");
                const week = currentWeekStart.toISOString();

                if (!schedule[week] && schedule[referenceWeek]) {
                    schedule[week] = JSON.parse(JSON.stringify(schedule[referenceWeek]));
                    localStorage.setItem("schoolSchedule", JSON.stringify(schedule));
                }

                const inputs = document.querySelectorAll("input[type='text'][data-day]");
                inputs.forEach(input => {
                    const day = input.dataset.day;
                    const hour = input.dataset.hour;
                    input.value = (schedule[week] && schedule[week][day] && schedule[week][day][hour]) || "";
                });
            } catch (error) {
                console.error("Errore in loadSchedule:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per aggiornare l'evidenziazione delle celle con note
        function updateNotesHighlight() {
            try {
                const notes = JSON.parse(localStorage.getItem("schoolNotes") || "{}");
                const week = currentWeekStart.toISOString();
                const thElements = document.querySelectorAll("#calendar-morning th:not(:first-child)");

                thElements.forEach((th, index) => {
                    const day = translations[currentLang].days.full[index];
                    const key = `${week}_${day}`;
                    const notesForDay = notes[key] || [];
                    const hasIncompleteNotes = notesForDay.length > 0 && notesForDay.some(note => !note.completed);
                    th.classList.toggle("has-notes", hasIncompleteNotes);
                });
            } catch (error) {
                console.error("Errore in updateNotesHighlight:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per aprire il pop-up delle note
        function openNotes(dayIndex) {
            try {
                currentDayNotes = dayIndex;
                const modal = document.getElementById("notes-modal");
                const notesList = document.getElementById("notes-list");
                const notesDay = document.getElementById("notes-day");
                const dayName = translations[currentLang].days.full[dayIndex];
                notesDay.textContent = dayName;

                const notes = JSON.parse(localStorage.getItem("schoolNotes") || "{}")[`${currentWeekStart.toISOString()}_${dayName}`] || [];
                notesList.innerHTML = "";

                for (let i = 0; i < 10; i++) {
                    const noteContainer = document.createElement("div");
                    noteContainer.classList.add("note-container");

                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.dataset.index = i;
                    checkbox.checked = notes[i]?.completed || false;
                    checkbox.addEventListener("change", () => {
                        noteContainer.classList.toggle("completed", checkbox.checked);
                    });

                    const input = document.createElement("input");
                    input.type = "text";
                    input.classList.add("note-input");
                    input.placeholder = `${translations[currentLang].note} ${i + 1}`;
                    input.value = notes[i]?.text || "";
                    if (notes[i]?.completed) {
                        noteContainer.classList.add("completed");
                    }

                    noteContainer.appendChild(checkbox);
                    noteContainer.appendChild(input);
                    notesList.appendChild(noteContainer);
                }

                modal.style.display = "flex";
            } catch (error) {
                console.error("Errore in openNotes:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per salvare le note
        function saveNotes() {
            try {
                const notesList = document.getElementById("notes-list");
                const noteContainers = notesList.querySelectorAll(".note-container");
                const notes = Array.from(noteContainers).map(container => {
                    const input = container.querySelector("input.note-input");
                    const checkbox = container.querySelector("input[type='checkbox']");
                    return {
                        text: input.value.trim(),
                        completed: checkbox.checked
                    };
                }).filter(note => note.text);

                if (notes.length > 10) {
                    showNotification(translations[currentLang].maxNotes);
                    return;
                }

                const allNotes = JSON.parse(localStorage.getItem("schoolNotes") || "{}");
                const dayName = translations[currentLang].days.full[currentDayNotes];
                allNotes[`${currentWeekStart.toISOString()}_${dayName}`] = notes;
                localStorage.setItem("schoolNotes", JSON.stringify(allNotes));
                updateNotesHighlight();
                closeNotes();
            } catch (error) {
                console.error("Errore in saveNotes:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per chiudere il pop-up delle note
        function closeNotes() {
            try {
                document.getElementById("notes-modal").style.display = "none";
                currentDayNotes = null;
            } catch (error) {
                console.error("Errore in closeNotes:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per aprire il pop-up dei voti
        function openGrades() {
            try {
                const modal = document.getElementById("grades-modal");
                const gradesList = document.getElementById("grades-list");
                const grades = JSON.parse(localStorage.getItem("schoolGrades") || "{}")[currentWeekStart.toISOString()] || {};

                gradesList.innerHTML = "";
                const subject = "Generale"; // Materia generica poiché gestione materie è rimossa
                const div = document.createElement("div");
                div.innerHTML = `<h3>${subject}</h3><strong>${translations[currentLang].oralGrades}</strong>`;
                const oralContainer = document.createElement("div");
                oralContainer.classList.add("grade-container");
                for (let i = 0; i < 10; i++) {
                    const oralInput = document.createElement("input");
                    oralInput.type = "text";
                    oralInput.classList.add("grade-input");
                    oralInput.placeholder = `${i + 1}`;
                    oralInput.value = grades[subject]?.oral?.[i] || "";
                    oralInput.dataset.subject = subject;
                    oralInput.dataset.type = "oral";
                    oralInput.dataset.index = i;
                    oralContainer.appendChild(oralInput);
                }
                div.appendChild(oralContainer);
                div.innerHTML += `<strong>${translations[currentLang].writtenGrades}</strong>`;
                const writtenContainer = document.createElement("div");
                writtenContainer.classList.add("grade-container");
                for (let i = 0; i < 10; i++) {
                    const writtenInput = document.createElement("input");
                    writtenInput.type = "text";
                    writtenInput.classList.add("grade-input");
                    writtenInput.placeholder = `${i + 1}`;
                    writtenInput.value = grades[subject]?.written?.[i] || "";
                    writtenInput.dataset.subject = subject;
                    writtenInput.dataset.type = "written";
                    writtenInput.dataset.index = i;
                    writtenContainer.appendChild(writtenInput);
                }
                div.appendChild(writtenContainer);
                gradesList.appendChild(div);

                modal.style.display = "flex";
            } catch (error) {
                console.error("Errore in openGrades:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per salvare i voti
        function saveGrades() {
            try {
                const gradesList = document.getElementById("grades-list");
                const inputs = gradesList.querySelectorAll("input");
                const grades = JSON.parse(localStorage.getItem("schoolGrades") || "{}");
                const week = currentWeekStart.toISOString();
                if (!grades[week]) grades[week] = {};

                inputs.forEach(input => {
                    const subject = input.dataset.subject;
                    const type = input.dataset.type;
                    const index = parseInt(input.dataset.index);
                    if (!grades[week][subject]) {
                        grades[week][subject] = {
                            oral: Array(10).fill(""),
                            written: Array(10).fill("")
                        };
                    }
                    grades[week][subject][type][index] = input.value.trim();
                });

                localStorage.setItem("schoolGrades", JSON.stringify(grades));
                closeGrades();
            } catch (error) {
                console.error("Errore in saveGrades:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per chiudere il pop-up dei voti
        function closeGrades() {
            try {
                document.getElementById("grades-modal").style.display = "none";
            } catch (error) {
                console.error("Errore in closeGrades:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per calcolare la media dei voti
        function calculateAverage(gradesArray) {
            try {
                const grades = gradesArray.map(g => parseFloat(g.trim())).filter(g => !isNaN(g) && g >= 0 && g <= 10);
                return grades.length ? (grades.reduce((sum, g) => sum + g, 0) / grades.length).toFixed(2) : "N/A";
            } catch (error) {
                console.error("Errore in calculateAverage:", error);
                return "N/A";
            }
        }

        // Funzione per mostrare le statistiche del primo quadrimestre
        function showFirstTerm() {
            try {
                const statsContent = document.getElementById("stats-content");
                const firstTermWeek = new Date(2024, 8, 1).toISOString();
                const grades = JSON.parse(localStorage.getItem("schoolGrades") || "{}")[firstTermWeek] || {};
                const subject = "Generale";

                statsContent.innerHTML = `<h3>${translations[currentLang].firstTermPeriod}</h3>`;
                const oralGrades = (grades[subject]?.oral || Array(10).fill("")).filter(g => g.trim());
                const writtenGrades = (grades[subject]?.written || Array(10).fill("")).filter(g => g.trim());
                const oralAvg = calculateAverage(oralGrades);
                const writtenAvg = calculateAverage(writtenGrades);
                statsContent.innerHTML += `
                    <p><strong>${subject}</strong>:<br>
                    ${translations[currentLang].oralGrades}: ${oralGrades.length ? oralGrades.join(", ") : translations[currentLang].noSubjects} (Media: ${oralAvg})<br>
                    ${translations[currentLang].writtenGrades}: ${writtenGrades.length ? writtenGrades.join(", ") : translations[currentLang].noSubjects} (Media: ${writtenAvg})</p>
                `;
            } catch (error) {
                console.error("Errore in showFirstTerm:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per mostrare le statistiche del secondo quadrimestre
        function showSecondTerm() {
            try {
                const statsContent = document.getElementById("stats-content");
                const secondTermWeek = currentWeekStart.toISOString();
                const grades = JSON.parse(localStorage.getItem("schoolGrades") || "{}")[secondTermWeek] || {};
                const subject = "Generale";

                statsContent.innerHTML = `<h3>${translations[currentLang].secondTermPeriod}</h3>`;
                const oralGrades = (grades[subject]?.oral || Array(10).fill("")).filter(g => g.trim());
                const writtenGrades = (grades[subject]?.written || Array(10).fill("")).filter(g => g.trim());
                const oralAvg = calculateAverage(oralGrades);
                const writtenAvg = calculateAverage(writtenGrades);
                statsContent.innerHTML += `
                    <p><strong>${subject}</strong>:<br>
                    ${translations[currentLang].oralGrades}: ${oralGrades.length ? oralGrades.join(", ") : translations[currentLang].noSubjects} (Media: ${oralAvg})<br>
                    ${translations[currentLang].writtenGrades}: ${writtenGrades.length ? writtenGrades.join(", ") : translations[currentLang].noSubjects} (Media: ${writtenAvg})</p>
                `;
            } catch (error) {
                console.error("Errore in showSecondTerm:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per mostrare i voti finali
        function showFinalGrades() {
            try {
                const finalGradesModal = document.getElementById("final-grades-modal");
                const finalGradesContent = document.getElementById("final-grades-content");
                const grades = JSON.parse(localStorage.getItem("schoolGrades") || "{}");
                const subject = "Generale";

                const firstTermWeek = new Date(2024, 8, 1).toISOString();
                const secondTermWeek = currentWeekStart.toISOString();

                finalGradesContent.innerHTML = `<h3>${translations[currentLang].finalGradesTitle}</h3>`;
                let allOralGrades = [];
                let allWrittenGrades = [];

                if (grades[firstTermWeek]?.[subject]?.oral) {
                    allOralGrades = allOralGrades.concat(grades[firstTermWeek][subject].oral.filter(g => g.trim()));
                }
                if (grades[firstTermWeek]?.[subject]?.written) {
                    allWrittenGrades = allWrittenGrades.concat(grades[firstTermWeek][subject].written.filter(g => g.trim()));
                }

                if (grades[secondTermWeek]?.[subject]?.oral) {
                    allOralGrades = allOralGrades.concat(grades[secondTermWeek][subject].oral.filter(g => g.trim()));
                }
                if (grades[secondTermWeek]?.[subject]?.written) {
                    allWrittenGrades = allWrittenGrades.concat(grades[secondTermWeek][subject].written.filter(g => g.trim()));
                }

                const oralAvg = calculateAverage(allOralGrades);
                const writtenAvg = calculateAverage(allWrittenGrades);
                finalGradesContent.innerHTML += `
                    <p><strong>${subject}</strong>:<br>
                    ${translations[currentLang].oralGrades}: ${oralAvg}<br>
                    ${translations[currentLang].writtenGrades}: ${writtenAvg}</p>
                `;

                finalGradesModal.style.display = "flex";
            } catch (error) {
                console.error("Errore in showFinalGrades:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per chiudere il pop-up dei voti finali
        function closeFinalGrades() {
            try {
                document.getElementById("final-grades-modal").style.display = "none";
            } catch (error) {
                console.error("Errore in closeFinalGrades:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per mostrare il pop-up delle statistiche
        function showStats() {
            try {
                const modal = document.getElementById("stats-modal");
                const statsContent = document.getElementById("stats-content");
                statsContent.innerHTML = `<p>${translations[currentLang].selectSubject}</p>`;
                modal.style.display = "flex";
            } catch (error) {
                console.error("Errore in showStats:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Funzione per chiudere il pop-up delle statistiche
        function closeStats() {
            try {
                document.getElementById("stats-modal").style.display = "none";
            } catch (error) {
                console.error("Errore in closeStats:", error);
                showNotification(translations[currentLang].error);
            }
        }

        // Inizializza il calendario e la settimana
        try {
            updateWeekDisplay();
        } catch (error) {
            console.error("Errore durante l'inizializzazione:", error);
            showNotification(translations[currentLang].error);
        }
    </script>
</body>
</html>
